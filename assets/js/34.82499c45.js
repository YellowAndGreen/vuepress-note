(window.webpackJsonp=window.webpackJsonp||[]).push([[34],{397:function(n,s,t){"use strict";t.r(s);var e=t(7),a=Object(e.a)({},(function(){var n=this,s=n._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":n.$parent.slotKey}},[s("h2",{attrs:{id:"使用opencv-4-5-4推理yolov5模型-分别使用c-python和ros实现。"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#使用opencv-4-5-4推理yolov5模型-分别使用c-python和ros实现。"}},[n._v("#")]),n._v(" 使用OpenCV 4.5.4推理YOLOv5模型，分别使用C++，Python和ROS实现。")]),n._v(" "),s("p",[s("strong",[n._v("基于")]),s("a",{attrs:{href:"https://github.com/doleron/yolov5-opencv-cpp-python",target:"_blank",rel:"noopener noreferrer"}},[s("strong",[n._v("yolov5-opencv-cpp-python")]),s("OutboundLink")],1),s("strong",[n._v("修改。")]),n._v(" 在原代码的基础上使用CMake编译（能够更方便的定义程序路径），并且加入了对ROS传入图片的支持。")]),n._v(" "),s("p",[n._v("代码地址：github.com/YellowAndGreen/Yolov5-OpenCV-Cpp-Python-ROS")]),n._v(" "),s("h3",{attrs:{id:"代码解释"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#代码解释"}},[n._v("#")]),n._v(" 代码解释")]),n._v(" "),s("ul",[s("li",[n._v("变量"),s("strong",[n._v("net_path")]),n._v("定义了onnx网络模型路径.")]),n._v(" "),s("li",[n._v("变量 "),s("strong",[n._v("class_path")]),n._v("定义了分类文件的路径.")]),n._v(" "),s("li",[n._v("ROS节点订阅**/image"),s("strong",[n._v("话题来获取输入图像. NOTE: The code depends on the output dimension of your network model, which means the variables "),s("strong",[n._v("dimensions and rows")]),n._v(" in ros.cpp should be the exact same size of output dimensions. 注意: 网络推理的计算取决于网络模型的输出维度, 也就是说ros.cpp中的变量")]),n._v("dimensions and rows**应该与其一致.")])]),n._v(" "),s("h3",{attrs:{id:"环境配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#环境配置"}},[n._v("#")]),n._v(" 环境配置")]),n._v(" "),s("ul",[s("li",[n._v("任何Linux OS (在Ubuntu 18.04上测试)")]),n._v(" "),s("li",[n._v("OpenCV 4.5.4+")]),n._v(" "),s("li",[n._v("Python 3.7+(可选)")]),n._v(" "),s("li",[n._v("GCC 9.0+(可选)")]),n._v(" "),s("li",[n._v("ROS melodic(可选)")])]),n._v(" "),s("p",[s("strong",[n._v("注意")]),n._v("!!! 先于4.5.4的OpenCV版本不会正常运行。")]),n._v(" "),s("h3",{attrs:{id:"使用ros-c-推理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#使用ros-c-推理"}},[n._v("#")]),n._v(" 使用ROS/C++推理")]),n._v(" "),s("p",[n._v("C++/ROS代码在"),s("a",{attrs:{href:"https://zhuanlan.zhihu.com/Yolo_ROS/ros.cpp",target:"_blank",rel:"noopener noreferrer"}},[n._v("Yolo_ROS/ros.cpp"),s("OutboundLink")],1),n._v("。")]),n._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[n._v("git clone https://github.com/YellowAndGreen/Yolov5-OpenCV-Cpp-Python-ROS.git\ncd Yolov5-OpenCV-Cpp-Python-ROS/Yolo_ROS\nmkdir build && cd build\ncmake ../\nmake\n./yolo_ros\n")])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br"),s("span",{staticClass:"line-number"},[n._v("4")]),s("br"),s("span",{staticClass:"line-number"},[n._v("5")]),s("br"),s("span",{staticClass:"line-number"},[n._v("6")]),s("br")])]),s("h3",{attrs:{id:"使用python推理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#使用python推理"}},[n._v("#")]),n._v(" 使用python推理")]),n._v(" "),s("p",[n._v("Python代码在"),s("a",{attrs:{href:"https://zhuanlan.zhihu.com/python/yolo.py",target:"_blank",rel:"noopener noreferrer"}},[n._v("python/yolo.py"),s("OutboundLink")],1),n._v(".")]),n._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[n._v("git clone https://github.com/YellowAndGreen/Yolov5-OpenCV-Cpp-Python-ROS.git\ncd Yolov5-OpenCV-Cpp-Python-ROS\npython python/yolo.py\n")])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br")])]),s("p",[n._v("使用GPU运行：")]),n._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[n._v("git clone https://github.com/YellowAndGreen/Yolov5-OpenCV-Cpp-Python-ROS.git\ncd Yolov5-OpenCV-Cpp-Python-ROS\npython python/yolo.py cuda\npython python/yolo-tiny.py cuda\n")])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br"),s("span",{staticClass:"line-number"},[n._v("4")]),s("br")])]),s("h3",{attrs:{id:"使用c-推理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#使用c-推理"}},[n._v("#")]),n._v(" 使用C++推理")]),n._v(" "),s("p",[n._v("C++代码在"),s("a",{attrs:{href:"https://zhuanlan.zhihu.com/cpp/yolo.cpp",target:"_blank",rel:"noopener noreferrer"}},[n._v("cpp/yolo.cpp"),s("OutboundLink")],1),n._v(".")]),n._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[n._v("git clone https://github.com/YellowAndGreen/Yolov5-OpenCV-Cpp-Python-ROS.git\ncd Yolov5-OpenCV-Cpp-Python-ROS/cpp\nmkdir build && cd build\ncmake ../\nmake\n./yolo_example\n")])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br"),s("span",{staticClass:"line-number"},[n._v("4")]),s("br"),s("span",{staticClass:"line-number"},[n._v("5")]),s("br"),s("span",{staticClass:"line-number"},[n._v("6")]),s("br")])]),s("h3",{attrs:{id:"导出yolov5-模型到onnx格式"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#导出yolov5-模型到onnx格式"}},[n._v("#")]),n._v(" 导出Yolov5 模型到onnx格式")]),n._v(" "),s("p",[n._v("https://github.com/ultralytics/yolov5/issues/251")]),n._v(" "),s("p",[n._v("我的指令是:")]),n._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[n._v("git clone https://github.com/ultralytics/yolov5\ncd yolov5\npip install -r requirements.txt\n")])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br")])]),s("p",[n._v("然后转换模型:")]),n._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[n._v("$ python3 export.py --weights yolov5n.pt --img 640 --include onnx\nexport: data=data/coco128.yaml, weights=['yolov5n.pt'], imgsz=[640], batch_size=1, device=cpu, half=False, inplace=False, train=False, optimize=False, int8=False, dynamic=False, simplify=False, opset=12, verbose=False, workspace=4, nms=False, agnostic_nms=False, topk_per_class=100, topk_all=100, iou_thres=0.45, conf_thres=0.25, include=['onnx']\nYOLOv5   v6.0-192-g436ffc4 torch 1.10.1+cu102 CPU\n\nFusing layers... \nModel Summary: 213 layers, 1867405 parameters, 0 gradients\n\nPyTorch: starting from yolov5n.pt (4.0 MB)\n\nONNX: starting export with onnx 1.10.2...\n/home/user/workspace/smartcam/yolov5/models/yolo.py:57: TracerWarning: Converting a tensor to a Python boolean might cause the trace to be incorrect. We can't record the data flow of Python values, so this value will be treated as a constant in the future. This means that the trace might not generalize to other inputs!\n  if self.onnx_dynamic or self.grid[i].shape[2:4] != x[i].shape[2:4]:\nONNX: export success, saved as yolov5n.onnx (7.9 MB)\n\nExport complete (1.33s)\nResults saved to /home/doleron/workspace/smartcam/yolov5\nVisualize with https://netron.app\nDetect with `python detect.py --weights yolov5n.onnx` or `model = torch.hub.load('ultralytics/yolov5', 'custom', 'yolov5n.onnx')\nValidate with `python val.py --weights yolov5n.onnx`\n$\n")])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br"),s("span",{staticClass:"line-number"},[n._v("4")]),s("br"),s("span",{staticClass:"line-number"},[n._v("5")]),s("br"),s("span",{staticClass:"line-number"},[n._v("6")]),s("br"),s("span",{staticClass:"line-number"},[n._v("7")]),s("br"),s("span",{staticClass:"line-number"},[n._v("8")]),s("br"),s("span",{staticClass:"line-number"},[n._v("9")]),s("br"),s("span",{staticClass:"line-number"},[n._v("10")]),s("br"),s("span",{staticClass:"line-number"},[n._v("11")]),s("br"),s("span",{staticClass:"line-number"},[n._v("12")]),s("br"),s("span",{staticClass:"line-number"},[n._v("13")]),s("br"),s("span",{staticClass:"line-number"},[n._v("14")]),s("br"),s("span",{staticClass:"line-number"},[n._v("15")]),s("br"),s("span",{staticClass:"line-number"},[n._v("16")]),s("br"),s("span",{staticClass:"line-number"},[n._v("17")]),s("br"),s("span",{staticClass:"line-number"},[n._v("18")]),s("br"),s("span",{staticClass:"line-number"},[n._v("19")]),s("br"),s("span",{staticClass:"line-number"},[n._v("20")]),s("br")])])])}),[],!1,null,null,null);s.default=a.exports}}]);